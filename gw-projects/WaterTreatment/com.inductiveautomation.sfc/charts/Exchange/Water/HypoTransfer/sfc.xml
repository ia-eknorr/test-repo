<?xml version="1.0" ?>
<sfc zoom="0.99999994" canvas="20 20" execution-mode="Callable" hot-editable="false" persist-state="true" redundant-sync="false">
	<onstart>def onStart(chart): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	pass
	</onstart>
	<oncancel>def onCancel(chart): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	pass</oncancel>
	<step id="c5cd5cd7-d19b-48a8-ad9e-8bfa3765c98a" location="1 0" name="__begin" factory-id="begin-step">
<parameters>
	<parameter key="true"><name>bulkTankNumber</name><expression>1</expression></parameter>
</parameters>
	</step>
	<step id="fd4d8c26-fc3e-4e52-9b14-6c2202459b89" location="1 1" name="Setup" factory-id="action-step">
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	# Set HypoTransfer UDT Reference Class
	chart.HypoTransfer = exchange.water.udt.getHypoTransfer()
	
	# Indicate transfer in progress
	chart.HypoTransfer.setInProcess(True, immediate=True)
	
	chart.pumpRate = chart.HypoTransfer.flowRate
	chart.timeout = chart.HypoTransfer.timeout
	chart.startTime = system.tag.readBlocking(['[System]Gateway/CurrentDateTime'])[0].value
	chart.nextBulk = 0</start-script>
	</step>
	<step id="378ca866-6f81-402b-a531-f43cf5bab618" location="1 3" name="InService" factory-id="action-step">
		<notes>Verify the specified Hypo Bulk Tank is in service</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	bulkTankPath = '[default]Exchange/Water/Tanks/HypoBulk{0}.InService'.format(chart.bulkTankNumber)
	
	chart.tankInService = system.tag.readBlocking([bulkTankPath])[0].value</start-script>
	</step>
	<step id="2a008dfb-c6c3-4ee1-a17b-48ee2767fea4" location="1 6" name="SrvMsg" factory-id="action-step">
		<notes>Display bulk tank not in service error message</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	# Read selected source bulk tank
	currentTank = chart.HypoTransfer.selectedBulkTank
	tank = system.tag.readBlocking("[default]Water/Hypo/Transfer/SelectedBulkTank")[0].value

	# Increment source bulk tank
	chart.bulkTankNumber = (currentTank % 3) + 1

	chart.nextBulk += 1

	# Populate message
	message = 'Bulk Tank #{0} not in service&lt;br&gt;Source is now Bulk Tank #{1}'.format(currentTank, chart.bulkTankNumber)
	chart.HypoTransfer.setMessage(message)
	chart.HypoTranfer.setSelectedBulkTankNumber(chart.bulkTankNumber)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="2f65eaad-c49c-476f-952e-6d5790e02a22" location="2 6" name="QtyCheck" factory-id="action-step">
		<notes>Verify the specified bulk tank has enough quantity</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	# Read filter level
	bulkTankPath = '[default]Exchange/Water/Tanks/HypoBulk{0}'.format(chart.bulkTankNumber)
	chart.bulkQty = system.tag.readBlocking([bulkTankPath])[0].value
	
	chart.tankReady = chart.bulkQty &gt;= 1020</start-script>
	</step>
	<step id="2969f3dd-6316-4b01-8565-f48318393a2c" location="9 1" name="OpenInlet" factory-id="action-step">
		<notes>Open Day Tank Inlet Valve</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	paths = ['[default]Exchange/Water/Valves/DTi/Auto']
	values = [1]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="1c01d12c-e1ad-4add-ab3a-fc2eaa59236e" location="9 2" name="InletOpen" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Valves/DTi"</expression></parameter>
	<parameter><name>desiredState</name><expression>1</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="902968a6-9421-481a-a566-00a0ade36f0b" location="2 9" name="QtyMsg" factory-id="action-step">
		<notes>Display bulk tank insufficient quantity error message</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	# Read selected source bulk tank
	currentTank = chart.HypoTransfer.selectedBulkTank
	
	# Increment source bulk tank
	source = (currentTank % 3) + 1

	chart.nextBulk += 1

	# Populate message
	message = 'Bulk Tank #{0} has insufficient quantity&lt;br&gt;Source is now Bulk Tank #{1}'.format(chart.bulkTankNumber, source)
	chart.HypoTransfer.setMessage(message)
	chart.HypoTransfer.setSelectedBulkTankNumber(source)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="0748ba6b-4f06-4a7b-a2b2-b042f18e5201" location="9 5" name="StartPump" factory-id="action-step">
		<notes>Start transfer pump</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	#paths = ['[default]Exchange/Water/Pumps/ChemTransfer/Hand']
	paths = ['[default]Exchange/Water/Pumps/ChemTransfer/Auto']
	values = [1]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="634eae94-0bdb-41bc-a763-47b261e3f9f6" location="9 6" name="PumpOn" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Pumps/ChemTransfer"</expression></parameter>
	<parameter><name>desiredState</name><expression>1</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="b3a69fa7-b729-4113-972d-8ccd648b19fe" location="3 11" name="OpenTank" factory-id="action-step">
		<notes>Open bulk tank valve</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	paths = ['[default]Exchange/Water/Valves/BT{0}/Auto'.format(chart.bulkTankNumber)]
	values = [1]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="d05c35bf-b774-4228-a5b2-f94e1f37d247" location="3 12" name="TankOpn" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Valves/BT" + {bulkTankNumber}</expression></parameter>
	<parameter><name>desiredState</name><expression>1</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="a051f7d3-e718-45a5-9db7-1ed6a6c52807" location="9 9" name="Pump" factory-id="action-step">
		<notes>Run transfer pump</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	# Read Day Tank quantity
	chart.dayTankCapacity = system.tag.readBlocking(["[default]Exchange/Water/Tanks/HypoDayTank.Capacity"])[0].value
	chart.dayQty = system.tag.readBlocking(["[default]Exchange/Water/Tanks/HypoDayTank"])[0].value
	chart.txQty = 0.0
	
	system.tag.writeBlocking(
		['[default]Exchange/Water/Hypo/HypoTransfer/Message']
		, ['Chemical Transfer in progress...']
	)</start-script>
	<timer-script interval="1000">def onTimer(chart, step):
	# Stop pumping if any of the valves get shut off
	inletPaths = [
		'[default]Exchange/Water/Valves/BT{0}/Value'.format(chart.bulkTankNumber)
		, '[default]Exchange/Water/Valves/TP/Value'
		, '[default]Exchange/Water/Pumps/ChemTransfer/Value'
	]
	inlet = all([tag.value == 1 for tag in system.tag.readBlocking(inletPaths)])
	tankLevel = chart.dayQty &lt;= 0.99 * chart.dayTankCapacity
	chart.continuePumping = all([tankLevel, inlet])
	# Prevent overflowing
	if chart.continuePumping:
		# Increment Transfer Quantity
		chart.txQty += (chart.pumpRate / 60.0)		# Convert gpm to gallons per second
		
		# Increment Day Tank Quantity
		chart.dayQty += (chart.pumpRate / 60.0)
		
		# Decrement Bulk Tank Quantity
		chart.bulkQty -= (chart.pumpRate / 60.0)
		
		# Write updated values to tags
		tags = [
			'[default]Exchange/Water/Tanks/HypoDayTank'
			, '[default]Exchange/Water/Tanks/HypoBulk{0}'.format(chart.bulkTankNumber)
		]
		system.tag.writeBlocking(tags, [chart.dayQty, chart.bulkQty])</timer-script>
	</step>
	<step id="a60ba2a7-3116-4109-b523-a8d325f8846b" location="14 1" name="CloseTx" factory-id="action-step">
		<notes>Close Transfer Pump Valve</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	paths = ['[default]Exchange/Water/Valves/TP/Auto']
	values = [0]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="137546aa-be82-4450-b617-02cebeae1f29" location="14 2" name="TxClosed" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Valves/TP"</expression></parameter>
	<parameter><name>desiredState</name><expression>0</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="99f2a601-b2c5-4559-926c-8a39219f8944" location="9 11" name="StopPump" factory-id="action-step">
		<notes>Stop transfer pump</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	paths = ['[default]Exchange/Water/Pumps/ChemTransfer/Auto']
	#paths = ['[default]Exchange/Water/Pumps/ChemTransfer/Hand']
	values = [0]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="87718bee-c1a7-43a0-9cd1-2968931ae3bb" location="14 5" name="CloseTank" factory-id="action-step">
		<notes>Close Bulk Tank Valve</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	paths = ['[default]Exchange/Water/Valves/BT{0}/Auto'.format(chart.bulkTankNumber)]
	values = [0]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="b5c5d5e1-d475-400a-a9c6-e5e4e4b7dee2" location="9 12" name="PumpOff" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Pumps/ChemTransfer"</expression></parameter>
	<parameter><name>desiredState</name><expression>0</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="99ce1d13-40bb-4b5c-be40-7c6f27f3052a" location="14 6" name="TankClose" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Valves/BT" + {bulkTankNumber}</expression></parameter>
	<parameter><name>desiredState</name><expression>0</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="9098b5f2-ee77-4590-8aab-c525145e48d0" location="4 15" name="OpenTx" factory-id="action-step">
		<notes>Open transfer pump valve</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	paths = ['[default]Exchange/Water/Valves/TP/Auto']
	values = [1]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="06c90ca3-bf9d-46f1-bf68-29d6ae290e46" location="4 16" name="TxOpen" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Valves/TP"</expression></parameter>
	<parameter><name>desiredState</name><expression>1</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="4ca3e923-7720-40f3-8a8a-f6f777bed4bc" location="14 9" name="Finish" factory-id="action-step">
		<notes>Populate transfer process tags</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	transferPaths = ['Message', 'TransferStart', 'LastTransfer', 'LastSource', 'LastGallons', 'InProcess',]
	transferValues = [
		''
		, chart.startTime
		, system.tag.readBlocking(['[System]Gateway/CurrentDateTime'])[0].value
		, chart.bulkTankNumber
		, chart.txQty
		, False
	]
	chart.HypoTransfer.addWrites(transferPaths, transferValues)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="2b58749e-eaca-4fbd-b39d-c4d5e7704858" location="14 10" name="__end2" factory-id="end-step">	</step>
	<step id="44c9b740-22a4-434f-afbc-ab4ba8d0fbfd" location="9 15" name="CloseInlet" factory-id="action-step">
		<notes>Close Day Tank Inlet Valve</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	paths = ['[default]Exchange/Water/Valves/DTi/Auto']
	values = [0]
	chart.HypoTransfer.addExternalWrites(paths, values)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="c433c72d-df9a-464b-af82-e5d27f82312d" location="9 16" name="InletClosed" factory-id="enclosing-step" chart-path="./Util/CheckTransferState" execution-mode="RunUntilCompletion">
<parameters>
	<parameter><name>transferPath</name><expression>"/Valves/DTi"</expression></parameter>
	<parameter><name>desiredState</name><expression>0</expression></parameter>
	<parameter><name>timeout</name><expression>{timeout}</expression></parameter>
</parameters>

<return-parameters>
	<return-parameter><enclosed-name>abort</enclosed-name><local-name>abort</local-name></return-parameter>
</return-parameters>
	</step>
	<step id="7b783d4b-c692-49c2-8add-fc8a76698737" location="15 12" name="TankError" factory-id="action-step">
		<notes>Display error message</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	chart.timer = 0</start-script>
	<timer-script interval="1000">def onTimer(chart, step):
	chart.timer += 1</timer-script>
	</step>
	<step id="8532aef7-f30c-4abd-a854-eef1c390295f" location="16 12" name="StateError" factory-id="action-step">
		<notes>Display error message</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	# Populate message
	message = 'Timeout reached waiting for device state to change'
	chart.HypoTransfer.setMessage(message, immediate=True)
	#system.tag.writeBlocking(["[default]Water/Hypo/Transfer/Message"], [msg])
	
	chart.timer = 0</start-script>
	<timer-script interval="1000">def onTimer(chart, step):
	chart.timer += 1</timer-script>
	</step>
	<step id="703d4497-f920-4741-be34-76492e20a338" location="16 15" name="Clear" factory-id="action-step">
		<notes>Reset modes and clear message</notes>
		<start-script>def onStart(chart, step): # WARNING: This resource was generated in a newer version of Ignition. For the best editing experience, recreate it in the current version.
	# Close all valves, stop pump, and clear message
	transferPaths = [
		'[default]Exchange/Water/Valves/BulkTank/Tank1/Auto'
		, '[default]Exchange/Water/Valves/BulkTank/Tank2/Auto'
		, '[default]Exchange/Water/Valves/BulkTank/Tank3/Auto'
		, '[default]Exchange/Water/Valves/TP/Auto'
		, '[default]Exchange/Water/Valves/DTi/Auto'
		, '[default]Exchange/Water/Pumps/ChemTransfer/Auto'
	]
	transferValues = [0, 0, 0, 0, 0, 0,]
	chart.HypoTransfer.addExternalWrites(transferPaths, transferValues)
	chart.HypoTransfer.setMessage('')
	chart.HypoTransfer.setInProcess(False)
	chart.HypoTransfer.writeTags()</start-script>
	</step>
	<step id="3f4c419c-9958-4915-88b5-b9f3019c65d0" location="16 16" name="__end1" factory-id="end-step">	</step>
	<transition id="669216f1-68cc-431e-9a0c-24cb63985378" location="1 5">!{tankInService}</transition>
	<transition id="1329071b-a44c-4544-822b-4bfb05f3d3fa" location="2 5">{tankInService}</transition>
	<transition id="20dec8c2-8dee-4dcd-b82f-d64fcfb8db57" location="2 8">!{tankReady}</transition>
	<transition id="33c6cef1-63e8-4292-87fd-eec7366b8aff" location="3 8">{tankReady}</transition>
	<transition id="d19a7eca-1ddb-4be7-b513-b7b363c7ea83" location="8 4">{abort}</transition>
	<transition id="391a23c3-2f9c-4933-b286-60ca45ffbf4d" location="9 4">!{abort}</transition>
	<transition id="7939a6d3-42de-41fe-a8f4-6cb1f83b2eca" location="8 8">{abort}</transition>
	<transition id="33ec1451-2332-44d9-b68f-6a4ad542d7d8" location="9 8">!{abort}</transition>
	<transition id="090b79b1-8153-44aa-a9c3-e2d7c1c51535" location="1 13">{nextBulk} &lt; 2</transition>
	<transition id="2d098f9e-8a8e-4f56-a637-b8b92f2c475f" location="2 13">{nextBulk} &gt;= 2</transition>
	<transition id="2539e8de-318e-4084-ac43-cca27467ace3" location="9 10">//{dayQty} &gt;= ((0.9 * {dayTankCapacity}) - ({pumpRate} / 60.0))
!{continuePumping}</transition>
	<transition id="25681418-07de-4958-8f89-2369fd8496c1" location="13 4">{abort}</transition>
	<transition id="fc3b96b2-48d6-44e4-beb4-eecbaedf06f6" location="3 14">{abort}</transition>
	<transition id="94dd8b20-7517-473c-bf3b-ff69ece6d192" location="14 4">!{abort}</transition>
	<transition id="670785aa-f126-4a15-8c57-341c07c6c445" location="4 14">!{abort}</transition>
	<transition id="d03ee2d5-0478-4953-98f9-df7315308fc1" location="13 8">{abort}</transition>
	<transition id="72928848-e4d2-424f-a93d-4e5b7935a6e4" location="14 8">!{abort}</transition>
	<transition id="54fecd13-7412-4aba-9adf-25406fffc6ba" location="8 14">{abort}</transition>
	<transition id="2e123f05-8c1e-4b4d-95b7-25d461c3356b" location="9 14">!{abort}</transition>
	<transition id="ff23cddd-ccac-40e7-affd-ede7d00e82b2" location="3 18">{abort}</transition>
	<transition id="3e2836d6-5b2c-45c7-8616-b4754fcd4a1b" location="4 18">!{abort}</transition>
	<transition id="75878949-1ffc-498a-8611-808b7d72261f" location="8 18">{abort}</transition>
	<transition id="21e296f9-9399-4284-8c20-bfe4b553bfd4" location="9 18">!{abort}</transition>
	<transition id="0a70de03-1426-44c0-b938-1b12de6a480f" location="16 14">{timer} &gt;= {timeout}</transition>
	<jump id="07a311aa-d92b-4a76-8347-f9b22a508961" location="8 5">A</jump>
	<jump id="bfa50271-c8a3-4b30-8684-c471aecb705a" location="8 9">A</jump>
	<jump id="fc5a8cdf-a2c0-49f9-a476-61278144c243" location="13 5">A</jump>
	<jump id="88acbfb2-eac7-4faf-9497-2913159fcb02" location="2 14">B</jump>
	<jump id="54bd70fe-3d65-48d4-9eaf-d7e0f574bf53" location="3 15">A</jump>
	<jump id="8e4e5801-d769-41e9-8cee-9390f327c32e" location="13 9">A</jump>
	<jump id="2740561b-c16e-4aeb-9539-80ce7fd450af" location="8 15">A</jump>
	<jump id="281ae400-d440-46df-8394-ce80493428b5" location="3 19">A</jump>
	<jump id="7a0b5be0-7439-4886-8c19-a18fb0ac0a23" location="8 19">A</jump>
	<anchor id="7b7dc7b5-8617-4546-9dff-23bf85557a5e" location="15 11">B</anchor>
	<anchor id="c21dcef0-9cce-47b9-81f7-ac36059e235f" location="16 11">A</anchor>
	<note id="67cf887d-7f03-4321-86f7-1bbae58d8e19" location="2 0" size="2 1" note-background="color(128,0,128,255)" note-foreground="color(255,255,255,255)">Params:
"bulkTankNumber"</note>
	<note id="a7ca7a2a-958e-43f9-825c-0786e877941e" location="2 1" size="2 2" note-background="color(128,0,128,255)" note-foreground="color(255,255,255,255)">pumpRate
timeout
startTime
</note>
	<note id="0b1deb8d-047f-49fc-ba2f-d3778e8d8a34" location="2 3" size="2 1">Verify Bulk Tank in service</note>
	<note id="a1f8aa62-eedc-49e9-9de1-892679eb76f8" location="3 5" size="2 2">Verify Bulk Tank quantity
&gt; 1020 gals
param "bulkQty"</note>
	<note id="d9712950-1f04-4259-9ce6-de7e47bf51cd" location="10 1" size="2 1">Open Day Tank Inlet Valve</note>
	<note id="dcf1ecb0-e623-4251-8a70-7336565c2ef7" location="10 2" size="2 1">Verify Day Tank Inlet Valve
Opened</note>
	<note id="3574a49a-7a33-4383-864e-f3af783665ca" location="10 5" size="2 1">Start Transfer Pump</note>
	<note id="2502cfa1-38ab-4078-bf1f-3ae4fe2432f1" location="10 6" size="2 1">Verify Transfer Pump
Running</note>
	<note id="58c8a0e1-5a73-44a5-a15e-19e122c104e3" location="4 11" size="2 1">Open Bulk Tank Valve</note>
	<note id="c1018e1e-711f-45de-9326-599b521e7538" location="4 12" size="2 1">Verify Bulk Tank Valve 
Opened</note>
	<note id="9a5f663a-6b34-4070-91ef-3232fdbcbb5b" location="10 9" size="2 2">Pump from Bulk Tank
to Day Tank
params "txQty", "dayQty",
   "bulkQty"
Update Level tags</note>
	<note id="0cd2ecfa-a8fc-4df3-8ebd-8118b233c168" location="10 11" size="2 1">Stop Transfer Pump</note>
	<note id="fd995304-ffbc-4b38-bf93-ea3e4ea6f4ff" location="0 15" size="3 3" note-background="color(255,202,138,255)">The above loop validates the selected
bulk tank is in service and has sufficient
quantity. If either condition isn't met, 
the next bulk tank is targeted and the
process repeated. If all 3 tanks are 
unable to handle the request an error is
displayed and an alarm set.</note>
	<note id="55672421-2943-4bcc-a056-363c66cd9d73" location="15 1" size="2 1">Close Transfer Pump Valve</note>
	<note id="34110e11-6635-4877-a102-d2969684d9e7" location="15 2" size="2 1">Verify Transfer Pump Valve 
Closed</note>
	<note id="2e42ace5-36e7-479b-ae97-723a37d38c36" location="10 12" size="2 1">Verify Transfer Pump
Stopped</note>
	<note id="7ee432b2-d475-465e-9435-c16ab3e64a5f" location="15 5" size="2 1">Close Bulk Tank Valve</note>
	<note id="2ea2eeed-2e69-4349-80ef-efc7fd824efc" location="5 15" size="2 1">Open Transfer Pump Valve</note>
	<note id="063bdbb7-cb5f-41ec-b899-da8abeda8dc5" location="15 6" size="2 1">Verify Bulk Tank Valve 
Closed</note>
	<note id="5a81adeb-300d-41d0-99a1-8be2062922d6" location="5 16" size="2 1">Verify Transfer Pump Valve 
Opened</note>
	<note id="317e8bfe-20fb-4820-8a47-07ad3bef0f6c" location="15 9" size="2 1">Clear Message
Set last transfer datetime</note>
	<note id="4a8ed6a5-a1f5-4df6-a075-714189ad0ec6" location="13 12" size="2 2" note-background="color(217,0,0,255)" note-foreground="color(255,255,255,255)">Display error message 
until timer exceeds
timeout</note>
	<note id="123b23e9-63c5-4604-a24c-baf23f9313d5" location="10 15" size="2 1">Close Day Tank Inlet Valve</note>
	<note id="b168ae24-3b06-47cf-8eda-85a8d97c8427" location="10 16" size="2 1">Verify Day Tank Inlet Valve
Closed</note>
	<note id="8a8a1f19-5040-4e99-9a7c-68914f8bfafd" location="13 14" size="3 2" note-background="color(217,0,0,255)" note-foreground="color(255,255,255,255)">Display error messages for 10 seconds,
then reset:
- Close all valves
- Stop Transfer Pump
</note>
	<note id="9123bea0-2a8f-45ad-9570-1675e61ca4bc" location="13 16" size="3 4">Hypo Transfer Process:
1) Verify specified Bulk Tank in service
2) Verify specified Bulk Tank has hypo
3) Open Bulk Tank valve
4) Open Transfer Pump valve
5) Open Day Tank inlet valve
6) Pump hypo from Bulk to Day Tank
7) Close Day Tank inlet valve
8) Close Transfer Pump valve
9) Close Bulk Tank valve</note>
	<link id="705b676d-9a42-491e-89c7-78710c26b880" location="0 2"><up/><down/><right/></link>
	<link id="4c7423d7-1d90-4e7c-8ff0-49eac52179f2" location="1 2"><up/><left/><down/><right/></link>
	<link id="a47269c8-5f99-48ee-9edf-e7186cf59fc0" location="0 3"><up/><down/></link>
	<link id="67edbb7a-2cfd-41cc-87da-631d669c8dff" location="0 4"><up/><down/></link>
	<link id="be8b540b-f2f7-4dc2-86db-112267e54f24" location="1 4"><up/><left/><down/><right/></link>
	<link id="1ff58fee-bcd9-4b46-a3d8-235e47faf88b" location="2 4"><up/><left/><down/><right/></link>
	<link id="e7c3ea6f-2277-4ebc-a6db-a40db0ea1c78" location="0 5"><up/><down/></link>
	<link id="1f84af00-d27e-432b-8a4d-278c05ae8afc" location="0 6"><up/><down/></link>
	<link id="088e1bcb-7211-45a2-95f9-6598c6a5c2ec" location="7 0"><left/><down/><right/></link>
	<link id="b7f0783b-fa6d-4437-be33-be4c0b1fbaf1" location="0 7"><up/><down/></link>
	<link id="2cf130bb-6103-41a4-9ae9-9502df658b4e" location="7 1"><up/><down/></link>
	<link id="2ab04385-666e-4764-a81e-493c6cd7a38b" location="1 7"><up/><down/></link>
	<link id="a23db106-43ed-49f6-a187-d2a6a7a5c1a3" location="7 2"><up/><down/></link>
	<link id="c134f75a-8dfb-41c0-9612-d7ae743e9864" location="2 7"><up/><down/><right/></link>
	<link id="fb35e73b-fca8-4a70-88c2-30e481f2e91e" location="7 3"><up/><down/></link>
	<link id="79224c4e-c330-467a-8b08-45f0c3557366" location="3 7"><up/><left/><down/><right/></link>
	<link id="d459f956-a2aa-4b79-8972-23ee3263a6ab" location="8 0"><left/><down/><right/></link>
	<link id="d9de4a23-e1b7-46ab-8952-99b3d3886874" location="0 8"><up/><down/></link>
	<link id="49e63533-8e5f-4d43-a610-757dfafddaaf" location="7 4"><up/><down/><right/></link>
	<link id="a410defc-c1f8-47d6-aa40-8e1af271a289" location="1 8"><up/><down/></link>
	<link id="03fd2e39-1f55-40b4-94b3-00856bb99c1c" location="8 3"><left/><down/><right/></link>
	<link id="69263cce-9961-47a5-90ea-7f23e77cfffc" location="7 5"><up/><down/></link>
	<link id="cff056e2-b09d-463f-b061-c82355006f5d" location="9 0"><left/><down/><right/></link>
	<link id="c766b93a-b4ab-4eb8-80cb-1594ea71ea0f" location="0 9"><up/><left/><down/><right/></link>
	<link id="aa43bffb-cfde-4069-90f8-865fa73c00ff" location="1 9"><up/><down/></link>
	<link id="ce7506ce-0fee-4496-8d43-05eab06340c6" location="7 6"><up/><down/></link>
	<link id="bb55404a-27be-4c68-bbe9-5ca9c6797f47" location="9 3"><up/><left/><down/><right/></link>
	<link id="9d9ab80a-a99a-44cd-9675-a8a34bf145ff" location="3 9"><up/><down/></link>
	<link id="a2fc5379-90a2-4749-b206-0c6534c53e16" location="7 7"><up/><down/></link>
	<link id="d123c140-28ed-4eec-bcde-bb805a4785f2" location="0 10"><up/><down/></link>
	<link id="308b62ce-0fe2-4204-b87b-99a837dd400a" location="1 10"><up/><down/><right/></link>
	<link id="15b45d0d-b05c-4240-af65-0a1ffee20d52" location="2 10"><up/><left/><down/></link>
	<link id="93e1acd7-5ac2-4ed6-9660-0125f77d6f7b" location="3 10"><up/><down/><right/></link>
	<link id="4e128528-8a0f-4f8a-9daf-c7386efa3c00" location="8 7"><left/><down/><right/></link>
	<link id="14061bbe-97e4-401a-90f4-e50707ac7e0c" location="7 8"><up/><down/></link>
	<link id="348b05d8-0371-4ca1-a39e-40151bd2015e" location="0 11"><up/><down/></link>
	<link id="99d54e55-37de-4585-8d31-a9432997b291" location="1 11"><up/><down/><right/></link>
	<link id="e4fe33ad-2764-4926-b3ff-2e30d090f054" location="9 7"><up/><left/><down/><right/></link>
	<link id="816e3fb8-0034-4891-a6fc-1e6caf00db0e" location="7 9"><up/><down/></link>
	<link id="c0c56a9f-df83-42bb-81ff-5535820ea45c" location="12 0"><up/><down/><right/></link>
	<link id="8562915d-cd76-4297-b25e-e095d28305bb" location="0 12"><up/><down/></link>
	<link id="dc803987-9424-4e7d-859c-a15ff01ac52f" location="12 1"><up/><down/></link>
	<link id="1db49f86-1804-4be9-93e3-84c9e42e6eb1" location="1 12"><up/><down/><right/></link>
	<link id="2499958b-ec3a-46f5-8f02-42ae8fb5e520" location="12 2"><up/><down/></link>
	<link id="b3ae35b3-558c-4bb5-b800-1c46db027d5a" location="2 12"><left/><down/><right/></link>
	<link id="e2db864b-cbd2-46d3-9962-5b9556369a4e" location="7 10"><up/><down/></link>
	<link id="a2964afd-b4b0-400f-b35f-5f3267a0a81c" location="12 3"><up/><down/></link>
	<link id="07bef5f9-72d3-4eb3-98f6-76d00c1367d2" location="12 4"><up/><down/></link>
	<link id="4aafa2fc-bdc0-4535-a4b5-3eef3bf0421c" location="13 0"><left/><right/></link>
	<link id="0ad204c2-4226-4f3b-900e-0aa49ae56a0b" location="12 5"><up/><down/></link>
	<link id="a2f38fca-8346-47e3-a5c9-88dc77387aaf" location="0 13"><up/><down/></link>
	<link id="4c91b61f-45ec-40cf-9cd6-98f4b32f3c10" location="7 11"><up/><down/></link>
	<link id="2af92371-c45a-438d-bbd7-42707ab5f268" location="13 3"><left/><down/><right/></link>
	<link id="3c2d11d3-4877-4116-871d-cae8e55e3088" location="3 13"><up/><left/><down/><right/></link>
	<link id="8ab23ccf-9352-41dc-8997-f8096b43a5bf" location="12 6"><up/><down/></link>
	<link id="a8adab3e-a64a-4677-857d-1294ae4cdd11" location="4 13"><up/><left/><down/></link>
	<link id="b1114a5a-21d7-48c8-9872-2c51b0fd3dee" location="12 7"><up/><down/></link>
	<link id="f03e8c13-8b82-4161-a999-3ed976afd51a" location="7 12"><up/><down/></link>
	<link id="47103641-d05b-438a-b68d-8c119e0ac7d4" location="14 0"><left/><down/><right/></link>
	<link id="c71cdcf8-d4ac-4fba-9dd0-f3aedf9459f5" location="0 14"><up/><left/><right/></link>
	<link id="06787627-f3f9-4498-9a6c-edf1ff55a9bc" location="1 14"><up/><left/><down/></link>
	<link id="20aaf636-d2f6-40ae-be04-9a757f96fb8a" location="14 3"><up/><left/><down/></link>
	<link id="01f3beb2-c095-43c5-8303-2d1569de8e1f" location="12 8"><up/><down/></link>
	<link id="7e30aa0a-0451-492e-b371-590b648e8058" location="13 7"><left/><down/><right/></link>
	<link id="90db66c4-d681-46d8-905f-c4a2b94b09ab" location="7 13"><up/><down/></link>
	<link id="109805eb-7b22-4fca-998e-ab94a64b5249" location="12 9"><up/><down/></link>
	<link id="e3f95738-ccc9-4254-a704-8ba1149bbc58" location="8 13"><left/><down/><right/></link>
	<link id="c66f29c6-7e58-4088-b531-9619b2e87a8d" location="12 10"><up/><down/></link>
	<link id="a9192551-55f5-4f51-9ae8-93130cc90570" location="14 7"><up/><left/><down/></link>
	<link id="a706706c-c1a3-474b-8627-ce53e9685fcb" location="7 14"><up/><down/></link>
	<link id="58cb9a9b-2d16-479c-9ad1-c94da4a0b3cd" location="9 13"><up/><left/><down/><right/></link>
	<link id="d78913f2-8251-4628-b53e-1e9d29391fcc" location="12 11"><up/><down/></link>
	<link id="33b68736-5487-4a31-8af0-78867a5ac3cf" location="7 15"><up/><down/></link>
	<link id="648dce91-fc22-4e9d-b94c-30c79cde5cf1" location="12 12"><up/><down/></link>
	<link id="55c93c8f-c422-4e73-9af6-2aa40da59994" location="3 17"><left/><down/><right/></link>
	<link id="59d7cedb-b818-4bc0-9c5a-51fdc093fef6" location="7 16"><up/><down/></link>
	<link id="2d463cbc-5c10-45ec-ae6b-51b08aadec4f" location="4 17"><up/><left/><down/></link>
	<link id="e1a6b56d-0604-4381-bb48-c0a39c950a02" location="12 13"><up/><down/></link>
	<link id="6207a2a2-baec-47cb-8859-23e0ade23307" location="7 17"><up/><left/><down/></link>
	<link id="53fe0cfd-d137-4e21-97dc-0ad2ff42aed5" location="12 14"><up/><down/></link>
	<link id="8a3a4295-e97c-46c5-a0db-13bdd40cdf7d" location="8 17"><left/><down/><right/></link>
	<link id="93487810-d34d-4022-8544-7f815cf50a8c" location="12 15"><up/><down/></link>
	<link id="2ff63484-3200-47bc-8185-5f026e1f453e" location="9 17"><up/><left/><down/><right/></link>
	<link id="be990dc4-5b51-44f5-b9be-f939914cec64" location="7 18"><up/><left/><down/><right/></link>
	<link id="90418e75-4a2e-4db2-aed1-45f002b7a2ee" location="4 19"><up/><down/><right/></link>
	<link id="823ce757-ed86-47b1-8400-c4a1ea7bc86d" location="5 19"><left/><right/></link>
	<link id="106c188a-8115-4077-8a3e-c125f3e41a38" location="15 13"><up/><left/><down/><right/></link>
	<link id="6f0f6758-cb4b-45d5-951d-f0b6fedcab92" location="6 19"><left/><right/></link>
	<link id="00ae5e25-b3cb-439d-b7ea-365f8c0c95aa" location="12 16"><up/><down/></link>
	<link id="ca41684b-6a72-42aa-bcf4-87e63c3047f2" location="7 19"><up/><left/><right/></link>
	<link id="6e9d7b25-6a85-4a71-9e40-6b1421698ed4" location="16 13"><up/><left/><down/><right/></link>
	<link id="6bfdfe62-6328-47f7-bab3-74a6b9adef09" location="12 17"><up/><left/><down/><right/></link>
	<link id="ccb67275-d52a-432b-92eb-f3e979b5f0ce" location="9 19"><up/><down/><right/></link>
	<link id="7391b38b-600a-41c0-ad74-377c62ebdee7" location="10 19"><left/><right/></link>
	<link id="fc53939f-a53f-4f40-bd2c-a36fcc75ca56" location="12 18"><up/><down/></link>
	<link id="e3c91037-7bed-4e23-ad92-84c4f2179d63" location="11 19"><left/><right/></link>
	<link id="6f4fb628-2a2f-4b3b-9f29-a7db7f9dc474" location="12 19"><up/><left/><right/></link>

</sfc>
